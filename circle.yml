machine:
  node:
    version: 4.6.0
  services:
    - docker

dependencies:
  override:
    - bundle install:

test:
  pre:
    - aws configure set default.region us-east-1
    - aws ecs describe-task-definition --task-definition pactbroker-family --query 'taskDefinition.containerDefinitions[0].portMappings[0].hostPort'
    - export pactbrokerurl=http://54.197.31.162:80
  override:
    - npm run mocha
#    - npm run fitnesse
    - npm run pact
#  post:
#    - docker build -t $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/mapmaker:$CIRCLE_SHA1 .
#    - docker run -d -p 3000-4000:3000 --name mapmaker $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/mapmaker:$CIRCLE_SHA1; sleep 10
#    - curl -sSf http://localhost:8080 > /dev/null

#deployment:
#  prod:
#    branch: master
#    commands:
#      - ./deploy.sh